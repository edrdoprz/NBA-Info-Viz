<!DOCTYPE html>
<html>
<head>
	<title>NBA Kidz Viz</title>
    <script type="text/javascript" src="d3.v2.js"></script>
	<script type="text/javascript" src="jquery-1.8.3.js"></script>
</head>
<body>
	<div id="historyLevel"></div>
	<div id="yearLevel"></div>
	<div id="seasonLevel"></div>
	<div id="teamLevel"></div>
	<div style="width:240px; height:25px; z-index:98;" id="teamName"></div>
	<div style="width:240px; height:25px; z-index:98;" id="playerName"></div>
	<button id="backbtn1" style="position:absolute; left:100px; top:100px; display:none; z-index:99;">Back</button>

	<button id="backbtn2" style="position:absolute; left:100px; top:100px; display:none; z-index:99;">Back</button>

	
	<div style="position:absolute; top:500px; left:900px; width:150px; height:150px; z-index:98; border:solid 3px gray; padding:5px; word-wrap:break-word;" id="playerInfo1">
		Empty

	</div>
	<div style="position:absolute; top:500px; left:1070px; width:150px; height:150px; z-index:98; border:solid 3px gray; padding:5px; word-wrap:break-word;" id="playerInfo2">
		Empty
	</div>

	<div style="position:absolute; top:100px; left:900px; width:320px; height:200px; z-index:98; border:solid 3px gray; padding:5px; word-wrap:break-word;" id="legend">
		<img src="legend.png">
	</div>

	<div style="position:absolute; top:360px; left:400px; width:300px; height:50px; z-index:98; word-wrap:break-word; text-align:center;" id="context">
		
	</div>

	<button id="clearText" style="position:absolute; left:900px; top:460px; z-index:99;">Clear</button>
	
	<script type="text/javascript">

		
		jQuery(document).ready(function($) {
			  	$.ajax({
					url : "allData.json",
			  		dataType : "json",
			  		success : function(dataReadIn) {
			  			
			  			// data from json in var
			  			var data = dataReadIn.overview;


			  			/////// original height was 700
						var svgHeight = 800;
						var svgWidth = 1000;
						var yearX = 0;
						var yearY = 0;
						var yearR = 0;
						var yearStroke = 0;
						var teamX = 0;
						var teamY = 0;
						var teamR = 0;
						var teamStroke = 0;
						
						var bigCircleR = 250;
						var bigCircleCX = svgWidth/2;
						var bigCircleCY = svgHeight/2;
						
						var yearCircleR = 60;
						var teamCircleR = 60;

						var seasonYear = 2012;
						var yearIndex = 0;
						var teamIndex = 0;

						var useStats = new Array();
						var playerNames = new Array();
						var bottomstats = new Array();

						var playerPicked1 = 0;
						var playerPicked2 = 0;

						var contextYear = 0;
						var contextTeamName = "";
						var contextImage = "";


						
						
						var number = 2012;
						console.log(dataReadIn);
						//console.log(dataReadIn["overview"].length);
						

						console.log("ScreenWidth");
						console.log(screen.width/2-svgWidth/2);
						// $('#historyLevel').attr('style', 'position:absolute; left:'+(screen.width/2-svgWidth/2)+'px; width:'+svgWidth+'px; height:'+svgHeight+'px; z-index: 1;');
						// $('#yearLevel').attr('style', 'position:absolute; left:'+(screen.width/2-svgWidth/2)+'px; width:'+svgWidth+'px; height:'+svgHeight+'px; z-index: 1;');
						// $('#seasonLevel').attr('style', 'position:absolute; left:'+ (screen.width/2-svgWidth/2)+'px; width:'+svgWidth+'px; height:'+svgHeight+'px; z-index: 1; display:none;');
						// $('#teamLevel').attr('style', 'position:absolute; left:'+ (screen.width/2-svgWidth/2)+'px; width:'+svgWidth+'px; height:'+svgHeight+'px; z-index: 1; display:none;');

						$('#historyLevel').attr('style', 'position:absolute; left:50px; width:'+svgWidth+'px; height:'+svgHeight+'px; z-index: 1;');
						$('#yearLevel').attr('style', 'position:absolute; left:50px; width:'+svgWidth+'px; height:'+svgHeight+'px; z-index: 1;');
						$('#seasonLevel').attr('style', 'position:absolute; left:50px; width:'+svgWidth+'px; height:'+svgHeight+'px; z-index: 1; display:none;');
						$('#teamLevel').attr('style', 'position:absolute; left:50px; width:'+svgWidth+'px; height:'+svgHeight+'px; z-index: 1; display:none;');

						
						
						// upcoming code is for season years circles
						
						// this creates history svg and initial big circle
						var historySVG = d3.select("#historyLevel")
					        .append("svg")
					        .attr("width", svgWidth)
					        .attr("height", svgHeight)
							.append("circle")
							.style("stroke", "black")
					        .style("fill", "none")
							.attr("class", "historyCircle")
							.attr("r", 	bigCircleR)
					        .attr("cx", bigCircleCX)
							.attr("cy", bigCircleCY)
							.attr("stroke-width", 20);
							
						// attaching svg to year, season, and team level
						var yearSVG = d3.select("#yearLevel")
					        .append("svg")
					        .attr("width", svgWidth)
					        .attr("height", svgHeight);

						var seasonSVG = d3.select("#seasonLevel")
					        .append("svg")
					        .attr("width", svgWidth)
					        .attr("height", svgHeight);

					   	var teamSVG = d3.select("#teamLevel")
					        .append("svg")
					        .attr("width", svgWidth)
					        .attr("height", svgHeight);
						
						
						
						// starting to add g elements and actual circles
						var radian = 0;
						var arrayLength = data.length;
						var seasonYears = yearSVG.selectAll("g.years")
							.data(data)
							.enter()
							.append("g")
							.attr("class", "years")
							.attr("data-year", function(d,i){	console.log(d);
																return d.year;

															})
							.on("click", disappearYear);
							



						// adding year circles to g elements
						seasonYears.append("svg:circle")
					        .style("stroke", "black")
							.style("stroke-width", 3)
					        .style("fill", "white")
							.attr("data-year", function(d){ return d.year; })
							.attr("class", "yearCircle")
					        .attr("r", yearCircleR)
					        .attr("cx", function(d,i){	radian = 2 * i * Math.PI/arrayLength - Math.PI/2;
														return Math.round(bigCircleR * Math.cos(radian) + bigCircleCX);
													})
							.attr("cy", function(d,i){	radian = 2 * i * Math.PI/arrayLength - Math.PI/2;
														console.log("CX: " + this.getAttribute("cx"));
														return Math.round(bigCircleR * Math.sin(radian) + bigCircleCY);
													});

						// adding year text to circles
						seasonYears.append("svg:text")
							.text(function(d,i){ return d.year; })
							.attr("class", "yearText")
					        .attr("x", function(d,i){	console.log(d3.selectAll(".yearCircle")[0][i].getAttribute("cx"));
					        							return d3.selectAll(".yearCircle")[0][i].getAttribute("cx"); })
					        .attr("y", function(d,i){	return d3.selectAll(".yearCircle")[0][i].getAttribute("cy"); })
					        .attr("dy", 7)
							.attr("text-anchor", "middle");

						
						// beginning transition from history level to season level
						function disappearYear() {
							

							$("#backbtn1").attr("style", "position:absolute; left:100px; top:100px; display:visible; z-index:99;");

							console.log("This:");
							console.log(d3.select(this).select(".yearCircle")[0][0].getAttribute("cx"));


							yearX = d3.select(this).select(".yearCircle")[0][0].getAttribute("cx");
							yearY = d3.select(this).select(".yearCircle")[0][0].getAttribute("cy");
							yearR = d3.select(this).select(".yearCircle")[0][0].getAttribute("r");

							console.log("yearX: " + yearX);
							console.log("yearY: " + yearY);
							console.log("yearR: " + yearR);



							// getting the year index so that we can access correct data in JSON
							contextYear = d3.select(this).select(".yearCircle").attr("data-year");
							yearIndex = seasonYear - contextYear;
							console.log("Year Index: " + yearIndex);


							

							// changing class of selected yr circle to distinguish it and moving it to center
							d3.select(this).select(".yearCircle")
								.attr("class", "abnormalYearCircle")
						    	.transition()
						        	.delay(0)
							        .duration(500)
							        .attr("cx", svgWidth/2)
									.attr("cy", svgHeight/2)
									.each("end", disappearYear2);
							

							function disappearYear2() {
								$('.yearText').fadeOut(700);
								$('.historyCircle').fadeOut(700);
								$('.yearCircle').fadeOut(700);

								// enlarge season circle and start adding season details by calling startSeason function
								d3.select(this)
							      .transition()
							        .duration(700)
							        .style("stroke-width", 20)
							        .attr("r", 250)
									.each("end", startSeason);
									
							}

						}


						function startSeason() {
							console.log("Start Season");
							console.log(data[yearIndex].teams[0]);
							
							// need to change the value of arrayLength because there are more teams than seasons
							arrayLength = data[yearIndex].teams.length;
							
							var seasonTeams = seasonSVG.selectAll("g.teams")
								.data(data[yearIndex].teams)
								.enter()
								.append("g")
								.attr("class", "teams")
								.attr("data-team", function(d){	return d["name"]; })
								.attr("data-image", function(d){	return d["teamImg"]; })
								.on("click", disappearSeason)
								.on("mouseover", function(d,i){ d3.select("#context").style("top", "330px");
																$('#context').html("<h3>"+d["name"]+"</br>Points: "+
																					  useStats[i][0][0]+"</br>Assists: "+
																					  useStats[i][1][0]+"</br>Rebounds: "+
																					  useStats[i][2][0]+"</br>FG Percent: "+
																					  useStats[i][3][0]+"%</br>Min Played: "+
																					  useStats[i][4][0]+"</h3>"); })
								.on("mouseout", function(d,i){ 	d3.select("#context").style("top", "360px");
																$('#context').html("<h1>"+contextYear+"</h1>"); });
							


							seasonTeams.append("svg:circle")
						        .style("stroke", "none")
								.style("stroke-width", 3)
						        .style("fill", "white")
								.attr("class", "teamfakeCircle")
								.attr("data-teamnumber", function(d,i) { return i; })
						        .attr("r", 	teamCircleR)
						        .attr("cx", function(d,i){	radian = 2 * i * Math.PI/arrayLength - Math.PI/2;
															return Math.round(bigCircleR * Math.cos(radian) + bigCircleCX); })
								.attr("cy", function(d,i){	radian = 2 * i * Math.PI/arrayLength - Math.PI/2;
															return Math.round(bigCircleR * Math.sin(radian) + bigCircleCY); });

							
							var tmpNumber = 0;
							seasonTeams.append("clipPath")
								.attr("id", function() { return "clipping"+tmpNumber++; })
								.attr("class", "clips")
								.append("svg:circle")
									.attr("r", teamCircleR)
							        .attr("cx", function(d,i){	radian = 2 * i * Math.PI/arrayLength - Math.PI/2;
																return Math.round(bigCircleR * Math.cos(radian) + bigCircleCX);
															})
									.attr("cy", function(d,i){	radian = 2 * i * Math.PI/arrayLength - Math.PI/2;
																console.log("CX: " + this.getAttribute("cx"));
																return Math.round(bigCircleR * Math.sin(radian) + bigCircleCY);
															});


							seasonTeams.append("image")
								.attr("class", "images")
								.attr("clip-path", function(d,i) { return "url(#clipping"+i+")"; })
								.attr("x", function(d,i){	radian = 2 * i * Math.PI/arrayLength - Math.PI/2;
															return Math.round(bigCircleR * Math.cos(radian) + bigCircleCX)-75;
														})
								.attr("y", function(d,i){	radian = 2 * i * Math.PI/arrayLength - Math.PI/2;
															console.log("CX: " + this.getAttribute("cx"));
															return Math.round(bigCircleR * Math.sin(radian) + bigCircleCY)-75;
														})
								.attr("width", 150)
								.attr("height", 150)
								.attr("xlink:href", function(d,i) { console.log("Image Name");
																	console.log(d);
																	return "Logos/Small/" + d["teamImg"]; })
								.style("opacity", .4);


							

							seasonTeams.append("svg:circle")
						        .style("stroke", "black")
								.style("stroke-width", 3)
						        .style("fill", "none")
								.attr("class", "teamCircle")
								.attr("data-teamnumber", function(d,i) { return i; })
						        .attr("r", 	teamCircleR)
						        .attr("cx", function(d,i){	radian = 2 * i * Math.PI/arrayLength - Math.PI/2;
															return Math.round(bigCircleR * Math.cos(radian) + bigCircleCX); })
								.attr("cy", function(d,i){	radian = 2 * i * Math.PI/arrayLength - Math.PI/2;
															return Math.round(bigCircleR * Math.sin(radian) + bigCircleCY); });
								
							
							
							seasonTeams.append("svg:text")
								.text(function(d,i){ return d["name"]; })
								.attr("class", "teamnameText")
								.attr("text-anchor", function(d,i){	if (i!=2 && i !=6)
						        										return "middle"; 
						        									else if (i==2)
						        										return "start";
						        									else
						        										return "end;"
						        							})
						        .attr("x", function(d,i){	if (i!=2 && i !=6) {
						        								return d3.selectAll(".teamCircle")[0][i].getAttribute("cx");
						        							}
						        							else if (i==2) {
						        								return parseFloat(d3.selectAll(".teamCircle")[0][i].getAttribute("cx"))+70;
						        							}
						        							else {
						        								if (contextYear==2012)
						        									return d3.selectAll(".teamCircle")[0][i].getAttribute("cx")-210;
						        								else if (contextYear==2010)
						        									return d3.selectAll(".teamCircle")[0][i].getAttribute("cx")-195;
						        								else if (contextYear==2008)
						        									return d3.selectAll(".teamCircle")[0][i].getAttribute("cx")-140;
						        								else
						        									return d3.selectAll(".teamCircle")[0][i].getAttribute("cx")-180;
						        							} })
						        .attr("y", function(d,i){	if (i==3 || i ==4 || i==5)
						        								return parseFloat(d3.selectAll(".teamCircle")[0][i].getAttribute("cy"))+70; 
						        							else if (i==0 || i==1 || i==7)
						        								return d3.selectAll(".teamCircle")[0][i].getAttribute("cy")-85; 
						        							else
						        								return d3.selectAll(".teamCircle")[0][i].getAttribute("cy");
						        							})
						        .attr("dy", 7)
								.style("font-weight", "bold");


							// need to create array for stats so D3 can easily iterate through using .enter
							// hard coded 8 because 8 teams
							for (var i = 0; i < 8; i++) {
								useStats[i] = [ [data[yearIndex].teams[i].big3ppg,0,0,0,i], [data[yearIndex].teams[i].big3assists,0,0,0,i], [data[yearIndex].teams[i].big3rebounds,0,0,0,i], [data[yearIndex].teams[i].big3fgPercent,0,0,0,i], [data[yearIndex].teams[i].big3minutesPlayed,0,0,0,i] ] ;
							}

							// useStats[0] = [ [data[yearIndex].teams[0].big3ppg,0,0,0,0], [data[yearIndex].teams[0].big3assists,0,0,0,0], [data[yearIndex].teams[0].big3rebounds,0,0,0,0], [data[yearIndex].teams[0].big3steals,0,0,0,0], [data[yearIndex].teams[0].big3blocks,0,0,0,0] ];
							// useStats[1] = [ [data[yearIndex].teams[1].big3ppg,0,0,0,1], [data[yearIndex].teams[1].big3assists,0,0,0,1], [data[yearIndex].teams[1].big3rebounds,0,0,0,1], [data[yearIndex].teams[1].big3steals,0,0,0,1], [data[yearIndex].teams[1].big3blocks,0,0,0,1] ];
							// useStats[2] = [ [data[yearIndex].teams[2].big3ppg,0,0,0,2], [data[yearIndex].teams[2].big3assists,0,0,0,2], [data[yearIndex].teams[2].big3rebounds,0,0,0,2], [data[yearIndex].teams[2].big3steals,0,0,0,2], [data[yearIndex].teams[2].big3blocks,0,0,0,2] ];
							// useStats[3] = [ [data[yearIndex].teams[3].big3ppg,0,0,0,3], [data[yearIndex].teams[3].big3assists,0,0,0,3], [data[yearIndex].teams[3].big3rebounds,0,0,0,3], [data[yearIndex].teams[3].big3steals,0,0,0,3], [data[yearIndex].teams[3].big3blocks,0,0,0,3] ];
							// useStats[4] = [ [data[yearIndex].teams[4].big3ppg,0,0,0,4], [data[yearIndex].teams[4].big3assists,0,0,0,4], [data[yearIndex].teams[4].big3rebounds,0,0,0,4], [data[yearIndex].teams[4].big3steals,0,0,0,4], [data[yearIndex].teams[4].big3blocks,0,0,0,4] ];
							// useStats[5] = [ [data[yearIndex].teams[5].big3ppg,0,0,0,5], [data[yearIndex].teams[5].big3assists,0,0,0,5], [data[yearIndex].teams[5].big3rebounds,0,0,0,5], [data[yearIndex].teams[5].big3steals,0,0,0,5], [data[yearIndex].teams[5].big3blocks,0,0,0,5] ];
							// useStats[6] = [ [data[yearIndex].teams[6].big3ppg,0,0,0,6], [data[yearIndex].teams[6].big3assists,0,0,0,6], [data[yearIndex].teams[6].big3rebounds,0,0,0,6], [data[yearIndex].teams[6].big3steals,0,0,0,6], [data[yearIndex].teams[6].big3blocks,0,0,0,6] ];
							// useStats[7] = [ [data[yearIndex].teams[7].big3ppg,0,0,0,7], [data[yearIndex].teams[7].big3assists,0,0,0,7], [data[yearIndex].teams[7].big3rebounds,0,0,0,7], [data[yearIndex].teams[7].big3steals,0,0,0,7], [data[yearIndex].teams[7].big3blocks,0,0,0,7] ];

							console.log(useStats);


							for (var i = 0; i < useStats.length; i++) {
								playerNames[i] = [ [data[yearIndex].teams[i].players[0], i], [data[yearIndex].teams[i].players[1], i], [data[yearIndex].teams[i].players[2], i] ] ;
							}

							console.log("Players Chosen");
							console.log(playerNames);


							// NOTE: recalculating radian in this section may not be necessary
							var tempCX = 0;
							var tempCY = 0;
							var tempR = 0;
							seasonTeams.append("svg:circle")
								.style("stroke", "black")
								.style("stroke-width", 2)
								.style("fill", function(){	return "none"; })
								.attr("data-black", 0)
								.attr("class", "avgstatsCircle")
								.attr("r", 	function(d,i){	tempR = 30;
															useStats[i][0][1] = tempR;
															return tempR; })
								.attr("cx", function(d,i){	radian = 2 * i * Math.PI/arrayLength - Math.PI/2;
															tempCX = Math.round(bigCircleR * Math.cos(radian) + bigCircleCX);
															useStats[i][0][2] = tempCX;
															return  tempCX; })
								.attr("cy", function(d,i){	radian = 2 * i * Math.PI/arrayLength - Math.PI/2;
															tempCY = Math.round(bigCircleR * Math.sin(radian) + bigCircleCY);
															useStats[i][0][3] = tempCY;
															return tempCY; });
							

							console.log(useStats);





							
							arrayLength = useStats[0].length;
							console.log("Array Length: " + arrayLength);
							var tempI = 0;
							seasonTeams.selectAll(".avgstat")
								.data(function(d,i) {	return useStats[i]; })
								.enter()
								.append("svg:circle")
								.style("stroke", "black")
								.style("fill", "black")
								.attr("class", "avgstat")
								.attr("r", 	function(d,i) {	var val = 0;
															switch(i)
															{
															// ppg
															case 0:
																val = d[0] * .6;
																break;
															// assists
															case 1:
																val = d[0] * 2;
																break;
															// rebounds
															case 2:
																val = d[0] * 1.3;
																break;
															// fg percent
															case 3:
																val = d[0] / 4;
																break;
															// minutes played
															case 4:
																val = d[0] / 4;
																break;
															}
															return val; })
								.attr("cx", function(d,i){	radian = 2 * i * Math.PI/arrayLength - Math.PI/2;
															return Math.round(useStats[d[4]][0][1] * Math.cos(radian) + useStats[d[4]][0][2]); })
								.attr("cy", function(d,i){	radian = 2 * i * Math.PI/arrayLength - Math.PI/2;
															return Math.round(useStats[d[4]][0][1] * Math.sin(radian) + useStats[d[4]][0][3]); });
							
							
							arrayLength = playerNames[0].length;
							seasonTeams.selectAll(".playerCircle")
								.data(function(d,i) {	return playerNames[i]; })
								.enter()
								.append("svg:circle")
								.style("stroke", "none")
								.style("stroke-width", 2)
								.style("fill", function(d,i){	if (d[0]["position"] == "F")
																	return "#0099cc"; 
																else if (d[0]["position"] == "G")
																	return "#ff3333";
																else if (d[0]["position"] == "C")
																	return "#33cc33";
																else
																	return "White"; })
								.attr("class", "playerCircle")
								.attr("r", 	15)
								.attr("cx", function(d,i){	radian = 2 * i * Math.PI/arrayLength - Math.PI/2;
															return Math.round(60 * Math.cos(radian) + useStats[d[1]][0][2]); })
								.attr("cy", function(d,i){	radian = 2 * i * Math.PI/arrayLength - Math.PI/2;
															return Math.round(60 * Math.sin(radian) + useStats[d[1]][0][3]); });


							// making the next level (div) visible, and context
							$('#context').html("<h1>"+contextYear+"</h1>");
							$('#seasonLevel').fadeIn(500);
							$('#context').fadeIn(500);
						}

						function disappearSeason() {
							// getting the team index so that we can access correct data in JSON
							teamIndex = d3.select(this).select(".teamCircle").attr("data-teamnumber");
							contextTeamName = d3.select(this).attr("data-team");
							contextImage = d3.select(this).attr("data-image");
							console.log("Team Index: " + teamIndex);


							teamX = d3.select(this).select(".teamCircle")[0][0].getAttribute("cx");
							teamY = d3.select(this).select(".teamCircle")[0][0].getAttribute("cy");
							teamR = d3.select(this).select(".teamCircle")[0][0].getAttribute("r");


							d3.select(this).select(".abnormalTeamFakeCircle")
								.attr("class", "teamfakeCircle")
								.transition()
						        	.delay(0)
							        .duration(500)
							        .attr("cx", svgWidth/2)
									.attr("cy", svgHeight/2)
									.each("end", disappearSeason2);

							d3.select(this).select(".clips").select("circle")
								.attr("class", "abnormalClips")
								.transition()
						        	.delay(0)
							        .duration(500)
							        .attr("cx", svgWidth/2)
									.attr("cy", svgHeight/2)
									.each("end", disappearSeason2);

							d3.select(this).select(".images")
								.attr("class", "abnormalImages")
								.transition()
						        	.delay(0)
							        .duration(500)
							        .attr("x", svgWidth/2-75)
									.attr("y", svgHeight/2-75)
									.each("end", disappearSeason2);


							// changing class of selected yr circle to distinguish it and moving it to center
							d3.select(this).select(".teamCircle")
								.attr("class", "abnormalTeamCircle")
						    	.transition()
						        	.delay(0)
							        .duration(500)
							        .attr("cx", svgWidth/2)
									.attr("cy", svgHeight/2)
									.each("end", disappearSeason2);
							

							function disappearSeason2() {
								$('.abnormalYearCircle').fadeOut(700);
								$('.teamCircle').fadeOut(700);
								$('.avgstatsCircle').fadeOut(700);
								$('.avgstat').fadeOut(700);
								$('.playerCircle').fadeOut(700);
								$('#context').fadeOut(500);
								$('.teamnameText').fadeOut(700);
								$('.teamfakeCircle').fadeOut(700);
								$('.clips').fadeOut(700);
								$('.images').fadeOut(700);
								

								// enlarge season circle and start adding season details by calling startSeason function
								d3.select(this)
							      .transition()
							        .duration(700)
							        .style("stroke-width", 20)
							        .attr("r", 250)
									.each("end", startTeam);
									
							}
						}

						function startTeam() {
							console.log("Start Team");
							
							// need to change the value of arrayLength
							arrayLength = playerNames[0].length;
							
							var teamPlayers = teamSVG.selectAll("g.playas")
								.data(playerNames[teamIndex])
								.enter()
								.append("g")
								.attr("class", "playas")
								.on("mouseover", function(d,i){ d3.select("#context").style("top", "330px");
																$('#context').html("<h3>"+d[0]["name"]+"</br>Points: "+
																					  d[0]["ppg"]+"</br>Assists: "+
																					  d[0]["assists"]+"</br>Rebounds: "+
																					  d[0]["rebounds"]+"</br>FG Percent: "+
																					  (Math.floor(d[0]["fgPercent"] * 10000) / 100)+"%</br>Min Played: "+
																					  d[0]["minutesPlayed"]+"</h3"); })
								.on("mouseout", function(d,i){ 	d3.select("#context").style("top", "360px");
																$('#context').html("<h1>"+contextYear+"</br>"+contextTeamName+"</h1>"); })
								.on("click", clickclick);
							

							function clickclick() {
							    // do something, "this" will be the DOM element
							    console.log("doubleclick");
							    console.log(d3.select(this).select(".playa")[0][0].getAttribute("data-whichplayer"));
							    var tmp = d3.select(this).select(".playa")[0][0].getAttribute("data-whichplayer");
							    var tmpPlayer = playerNames[teamIndex][tmp];
							    console.log(tmpPlayer);
							    if (playerPicked1 == 0) {
							    	playerPicked1 = 1;
							    	d3.select("#playerInfo1").html(
							    		"<b>Name:</b> " + tmpPlayer[0]["name"] + "</br>" +
							    		"<b>Points:</b> " + tmpPlayer[0]["ppg"] + "</br>" +
							    		"<b>Assists:</b> " + tmpPlayer[0]["assists"] + "</br>" +
							    		"<b>Rebounds:</b> " + tmpPlayer[0]["rebounds"] + "</br>" +
							    		"<b>FG Percent:</b> " + (Math.floor(tmpPlayer[0]["fgPercent"]*10000)/100) + "%</br>" +
							    		"<b>Min Played:</b> " + tmpPlayer[0]["minutesPlayed"]);
							    }
							    else {
							    	playerPicked1 = 0;
							    	d3.select("#playerInfo2").html(
							    		"<b>Name:</b> " + tmpPlayer[0]["name"] + "</br>" +
							    		"<b>Points:</b> " + tmpPlayer[0]["ppg"] + "</br>" +
							    		"<b>Assists:</b> " + tmpPlayer[0]["assists"] + "</br>" +
							    		"<b>Rebounds:</b> " + tmpPlayer[0]["rebounds"] + "</br>" +
							    		"<b>FG Percent:</b> " + (Math.floor(tmpPlayer[0]["fgPercent"]*10000)/100) + "%</br>" +
							    		"<b>Min Played:</b> " + tmpPlayer[0]["minutesPlayed"]);

							    }
							}




							// putting all the data for three players for last level
							for (var i = 0; i < playerNames[teamIndex].length; i++) {
								bottomstats[i] = [ [playerNames[teamIndex][i][0]["ppg"],0,0,i], [playerNames[teamIndex][i][0]["assists"],0,0,i], [playerNames[teamIndex][i][0]["rebounds"],0,0,i], [playerNames[teamIndex][i][0]["fgPercent"],0,0,i], [playerNames[teamIndex][i][0]["minutesPlayed"],0,0,i] ];
							}

							console.log("Bottom Stats");
							console.log(bottomstats);




							teamPlayers.append("svg:circle")
						        .style("stroke", "none")
								.style("stroke-width", 3)
						        .style("fill", function(d,i){	if (d[0]["position"] == "F")
																	return "#0099cc"; 
																else if (d[0]["position"] == "G")
																	return "#ff3333";
																else if (d[0]["position"] == "C")
																	return "#33cc33";
																else
																	return "White"; })
								.attr("class", "playa")
								.attr("data-whichplayer", function(d,i){ return i; })
						        .attr("r", 	80)
						        .attr("cx", function(d,i){	radian = 2 * i * Math.PI/arrayLength - Math.PI/2;
															tempCX = Math.round(bigCircleR * Math.cos(radian) + bigCircleCX);
															bottomstats[i][0][1] = tempCX;
															return tempCX; })
								.attr("cy", function(d,i){	radian = 2 * i * Math.PI/arrayLength - Math.PI/2;
															tempCY = Math.round(bigCircleR * Math.sin(radian) + bigCircleCY);;
															bottomstats[i][0][2] = tempCY;
															return tempCY; });



							

							




							// 5 because we are drawing the 5 stats here
							arrayLength = 5;
							teamPlayers.selectAll(".bottomstats")
								.data(function(d,i) {	console.log(bottomstats[i]);
														return bottomstats[i]; })
								.enter()
								.append("svg:circle")
								.style("stroke", "white")
								.style("stroke-width", 3)
								.style("fill", "gray")
								.attr("class", "playastat")
								.attr("r", 	function(d,i) {	var val = 0;

															switch(i)
															{
															// ppg
															case 0:
																val = d[0] *1.5;
																break;
															// assists
															case 1:
																val = d[0] * 2*2;
																break;
															// rebounds
															case 2:
																val = d[0] * 1.3*2;
																break;
															// fg percent
															case 3:
																val = d[0]*100;
																break;
															// minutes played
															case 4:
																val = d[0];
																break;
															}
															return val; })
								.attr("cx", function(d,i){	radian = 2 * i * Math.PI/arrayLength - Math.PI/2;
															return Math.round(80 * Math.cos(radian) + bottomstats[d[3]][0][1]); })
								.attr("cy", function(d,i){	radian = 2 * i * Math.PI/arrayLength - Math.PI/2;
															return Math.round(80 * Math.sin(radian) + bottomstats[d[3]][0][2]); });


							teamPlayers.append("svg:text")
								.text(function(d,i){ return d[0]["name"]; })
								.attr("class", "teamplayerText")
								.attr("text-anchor", function(d,i){	if (i==0)
						        										return "middle"; 
						        									else if (i==1)
						        										return "start";
						        									else
						        										return "end";
						        							})
						        .attr("x", function(d,i){	if (i==0)
				        										return d3.selectAll(".playa")[0][i].getAttribute("cx"); 
				        									else if (i==1)
				        										return d3.selectAll(".playa")[0][i].getAttribute("cx");
				        									else
				        										return d3.selectAll(".playa")[0][i].getAttribute("cx");
						        							 })
						        .attr("y", function(d,i){	if (i==0)
				        										return d3.selectAll(".playa")[0][i].getAttribute("cy")-100; 
				        									else if (i==1)
				        										return d3.selectAll(".playa")[0][i].getAttribute("cy")-(-90);
				        									else
				        										return d3.selectAll(".playa")[0][i].getAttribute("cy")-(-90);
						        							})
						        .attr("dy", 7)
								.style("font-weight", "bold");





							// making the next level (div) visible
							$('#context').html("<h2>"+contextYear+"</br>"+ contextTeamName+"</h2>");
							$('#context').fadeIn(500);
							$('#teamLevel').fadeIn(500);
							$("#backbtn1").attr("style", "position:absolute; left:100px; top:100px; display:none; z-index:99;");
							$("#backbtn2").attr("style", "position:absolute; left:100px; top:100px; display:visible; z-index:99;");
						}


						function backToHistory(){
							$('.teams').fadeOut(1000);
							$('#context').fadeOut(1000);


							d3.select(".abnormalYearCircle")
						      .transition()
						        .duration(700)
						        .delay(700)
						        .attr("r", yearR)
								.each("end", backToHistory2);


							function backToHistory2() {
								$("#backbtn1").attr("style", "position:absolute; left:100px; top:100px; display:none; z-index:99;");
									
								d3.select(".abnormalYearCircle")
								  .attr("class", "yearCircle")
							      .transition()            
							        .delay(0)            
							        .duration(700)
							        .attr("cx", yearX)
									.attr("cy", yearY)
									.attr("stroke-width", 3)
							        .each("end", backToHistory3);
							}

							function backToHistory3() {
								$('.yearText').fadeIn(700);
								$('.historyCircle').fadeIn(700);
								$('.yearCircle').fadeIn(700);
								
								// making season level invisible so we can click on stuff in first level again
								$('#seasonLevel').attr('style', 'position:absolute; left:50px; width:'+svgWidth+'px; height:'+svgHeight+'px; z-index: 1; display:none;');
							
								seasonSVG.selectAll(".teams").remove();
							}
						}

						function backToSeason(){
							$('.playas').fadeOut(1000);
							$('#context').fadeOut(1000);


							d3.select(".abnormalTeamCircle")
						      .transition()
						        .duration(700)
						        .delay(700)
						        .attr("r", yearR)
								.each("end", backToSeason2);


							function backToSeason2() {
								$("#backbtn1").attr("style", "position:absolute; left:100px; top:100px; display:visible; z-index:99;");
								$("#backbtn2").attr("style", "position:absolute; left:100px; top:100px; display:none; z-index:99;");

								d3.select(".abnormalTeamCircle")
								  .attr("class", "teamCircle")
							      .transition()            
							        .delay(0)            
							        .duration(700)
							        .attr("cx", teamX)
									.attr("cy", teamY)
									.style("stroke-width", 3)
							        .each("end", backToSeason3);

							    d3.select(".abnormalTeamFakeCircle")
									.attr("class", "teamfakeCircle")
									.transition()
							        	.delay(0)
								        .duration(700)
								        .attr("cx", teamX)
										.attr("cy", teamY)
										.each("end", backToSeason3);

								d3.select(".abnormalImages")
									.attr("class", "images")
									.transition()
							        	.delay(0)
								        .duration(700)
								        .attr("x", teamX-75)
										.attr("y", teamY-75)
										.each("end", backToSeason3);

								d3.select(".abnormalClips")
									.attr("class", "clips")
									.transition()
							        	.delay(0)
								        .duration(700)
								        .attr("r", yearR)
								        .attr("cx", teamX)
										.attr("cy", teamY)
										.each("end", backToSeason3);

								
							}

							function backToSeason3() {
								$('#context').html("<h1>"+contextYear+"</h1>");
								$('.abnormalYearCircle').fadeIn(700);
								$('.teamCircle').fadeIn(700);
								$('.avgstat').fadeIn(700);
								$('.avgstatsCircle').fadeIn(700);
								$('.playerCircle').fadeIn(700);
								$('#context').fadeIn(500);
								$('.teamnameText').fadeIn(500);
								$('.teamfakeCircle').fadeIn(700);
								$('.clips').fadeIn(700);
								$('.images').fadeIn(700);
								
								
								// making season level invisible so we can click on stuff in first level again
								$('#teamLevel').attr('style', 'position:absolute; left:50px; width:'+svgWidth+'px; height:'+svgHeight+'px; z-index: 1; display:none;');
							
								teamSVG.selectAll(".playas").remove();
							}
						}

						function clearPlayerText() {
							$('#playerInfo1').html("Empty");
							$('#playerInfo2').html("Empty");

							playerPicked1 = 0;
							playerPicked2 = 0;
						}




			  		}
			  	})
		});
	</script>

</body>
</html>